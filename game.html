<!DOCTYPE html>
<html>

<head>
    <title>Flabby bird 2018</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
    <div class="bottomCon">
        <h2 class="title"> Flappybird </h2>

        <button class="stitch-up" type="button" onClick="window.location.reload()">Reset Game</button>
        <p class="instructions"> Press space bar to jump <br> Dont hit the pipes or the bottom <br> Press reset button to play again </p>
        <h1 class="credit"> Blake Purdue , 2018 </h1>


    </div>
    <canvas id="gameCanvas" width="600" height="550"> </canvas>
    <script src="player.js"></script>
    <script src="pipe.js"></script>
    <script>
        var canvas, canvasContext;

        window.onload = function() { // On load function which loads up the canvas , sets to 2d , looks for space key pressed and released and sets the interval to 1000/50 , refresh rate like 50fps
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');

            document.addEventListener('keydown', keyPressed);
            document.addEventListener('keyup', keyReleased);

            setInterval(mainLoop, 1000 / 50);


        }
        var xPos = 0;
        var score = 0;
        var gameover = false;
        var pxPos = 0;
        var pyPos = 0;
        const PLAYER_WIDTH = 30;
        const PLAYER_HEIGHT = 40;
        var Xspeed = 0;
        var Yspeed = 0;
        const SPACE_KEY = 32;
        var spaceKeyPressed = false;
        var pipes = [];
        var pipesTotal = 18;
        var pipeCount = 0;
        var pipePearsCount = 0;
        var yRand = 0;

        var settingUp = true;
        var pipePairCount = 0;
        var Gap = 100;

        var yVelocity = -2;
        var diff= '';
        var bird = new Player(pxPos, pyPos, PLAYER_WIDTH, PLAYER_HEIGHT, "yellow", Xspeed, Yspeed)

        var playerName = prompt("Please enter your name", "Flappy Bird");

        while (diff !='easy' &&  diff != 'hard') {
            diff = prompt ("What do you want ?" , "Easy") ||'';
            diff = diff.toLowerCase();
        }

        if(diff == 'easy') {
            Xspeed = 2;
            console.log ("easy is 2");
        }
        if(diff == 'hard') {
            Xspeed = 6;
            console.log ("hard is 6");
        }
        function mainLoop() { // Main loop function , used to run all functions listed bellow on loop, like the bird movement and pipe draw 
            colorRect(0, 0, canvas.width, canvas.height, 'black');
            bird.playerDraw();
            bird.playerMove();
            
            if (settingUp) {
                //makePipes();
                for (i = 0; i < pipesTotal; i++) {
                    up();
                    bottom();
                }
                settingUp = false;
            }

            if (pipes.length > 0) {
                pipes.forEach(function(pipe, i) {
                    pipe.pipeDraw();
                    pipe.pipeMove();
//                    pipe.score();
                    if(pipe.x < 0){
                       delete pipes[i];
                        score++;
                    }
                });
                pipes = pipes.filter(item => item !== undefined);
            }
        }

        function colorRect(x, y, w, h, c) { // Colorrect function to draw the canvas background
            canvasContext.fillStyle = c;
            canvasContext.fillRect(x, y, w, h);
        }

        function keyPressed(evt) { // Function looking for the space key being pressed down, sets the var spaceKeyPressed to truce once detected  
            if (evt.keyCode == SPACE_KEY) {
                spaceKeyPressed = true;
            }
        }

        function keyReleased(evt) { // Function looking for the space key being released, sets the var spaceKeyPressed to false once detected  
            if (evt.keyCode == SPACE_KEY) {
                spaceKeyPressed = false;
            }
        }

        //function makePipes(){
        //        drawTopPipe();
        //        console.log("running function for making pipes");
        //      pipeNumber ++;
        //    console.log("amount of pipes" + pipeNumber);
        //}

        function up() { // function for the top part of the bar 
            Gap = Math.floor(Math.random() * (250 - 230) + 230); // Using a math random to generate random distance between gaps, give the game increased level of diffuculty and keeps the player guessing whilst also used to generate height of top and bottom pipes to insure thier a gape etc 
            var yPos = 0; // Using a math random to generate random y pos
            var xPos = canvas.width + pipePairCount * Gap; // x pos is through anvas.width + pipePairCount * Gap, this keeps even number of pipe for top and bottom inline, as the pipeCount increases , this helps keep track of the number of pipes and keep them inline together
            const WIDTH = 40; // Sets the thickness of the pipes 
            var height = Math.floor(Math.random() * (200 - 170) + 170); // math random to generate random height, which keeps the player guessing

            var p = new Pipe(xPos, yPos, WIDTH, height, "red", Xspeed) // Pushes the top pipe to draw function to draw onto canvas 
            pipes.push(p);
        }

        function bottom() { // funtion for the bottom part of the bar
            var yPos = canvas.height - Math.floor(Math.random() * ((canvas.height * 0.4) - 100) + 100); // Using a math random * the canvas height to generate random y pos
            var xPos = canvas.width + pipePairCount * Gap; // x pos is through anvas.width + pipePairCount * Gap, this keeps even number of pipe for top and bottom inline, as the pipeCount increases , this helps keep track of the number of pipes and keep them inline together 
            const WIDTH = 40; // Sets the thickness of the pipes 
            var height = Math.floor(Math.random() * (300 - 200) + 200); // math random to generate random height, which keeps the player guessing
            console.log('Gap: ' + Gap + ' pipeCount: ' + pipePairCount + "=" + xPos);
            var p = new Pipe(xPos, yPos, WIDTH, height, "blue", Xspeed) // Pushes the bottom pipe to draw function to draw onto canvas 
            pipes.push(p);

            pipePairCount++; // Once both top and bottom draw functions have been run / drawn , increases the pipeCount by 1, which allows the two top and bottom parts to keep together, through the yPos caculatations. 
        }
    
    </script>




</body>

</html>
